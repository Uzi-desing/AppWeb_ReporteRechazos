{% extends "navegacion.html" %}
{% block content %}

{% if request.user.is_authenticated %}
    {% csrf_token %}
    <p class="mb-4 text-sm text-black/80">Bienvenido <span class="font-medium">{{ request.user.username }}</span> ¿Qué deseas hacer hoy?</p>

    <div class="flex flex-wrap gap-3 mb-8">
        <a href="{% url 'crear_entrega' %}" 
            class="inline-flex items-center rounded-md border border-black px-4 py-2 text-sm font-medium text-black hover:bg-brand hover:border-brand hover:text-white transition-colors">
            <i data-lucide="package" class="w-4 h-4 mr-2"></i>
            Crear Entrega
        </a>

        <a href="{% url 'crear_obra' %}"
        class="inline-flex items-center rounded-md border border-black px-4 py-2 text-sm font-medium text-black hover:bg-brand hover:border-brand hover:text-white transition-colors">
        <i data-lucide="hammer" class="w-4 h-4 mr-2"></i>
        Registrar Obra
        </a>

        <a href="{% url 'crear_empleado' %}"
        class="inline-flex items-center rounded-md border border-black px-4 py-2 text-sm font-medium text-black hover:bg-brand hover:border-brand hover:text-white transition-colors">
        <i data-lucide="user-plus" class="w-4 h-4 mr-2"></i>
        Registra Empleado
        </a>

        <a href="{% url 'crear_cliente' %}"
        class="inline-flex items-center rounded-md border border-black px-4 py-2 text-sm font-medium text-black hover:bg-brand hover:border-brand hover:text-white transition-colors">
        <i data-lucide="users" class="w-4 h-4 mr-2"></i>
        Registrar Cliente
        </a>

        <a href="{% url 'tabla_reportes' %}"
        class="inline-flex items-center rounded-md border border-black px-4 py-2 text-sm font-medium text-black hover:bg-brand hover:border-brand hover:text-white transition-colors">
        <i data-lucide="table" class="w-4 h-4 mr-2"></i>
        Ver Tabla de Reportes
        </a>

        
    </div>

    {% if reporte %}
    <div class="rounded-lg border border-black/10 bg-white p-5 shadow-sm">
        <h3 class="text-lg font-semibold mb-2">Último reporte registrado: <span class="text-brand">Reporte N°{{ reporte.idReporte }}</span></h3>
        <p class="text-sm">Cliente: <span class="font-medium">{{ reporte.idCliente.nombre }}</span></p>
        <p class="text-sm">Empleado Encargado: <span class="font-medium">{{ reporte.idEmpleado.nombre|title }} {{ reporte.idEmpleado.apellido|title }}</span></p>
        <p class="text-sm mb-4">Conductor: <span class="font-medium">{{ reporte.idConductor.nombre|title }} {{ reporte.idConductor.apellido|title }}</span></p>
        <a href="{% url 'detalle_reporte' reporte.idReporte %}"
           class="inline-flex items-center rounded-md border border-black px-3 py-1.5 text-sm font-medium text-black hover:bg-brand hover:border-brand hover:text-white transition-colors">
            Ver detalles
        </a>
    </div>
    

    {% else %}
        <p class="text-sm text-black/70">No hay reportes registrados aún.</p>
    {% endif %}

    <br>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        
        <div class="rounded-lg border border-black/10 bg-white p-5 shadow-sm">
            <div class="flex items-center">
                <i data-lucide="package" class="w-6 h-6 mr-3 text-brand"></i>
                <h3 class="text-sm font-semibold text-black/70 uppercase">Piezas Registradas</h3>
            </div>
            <p class="text-2xl font-bold mt-2 text-black">
                {{ total_piezas }}
            </p>
            <p class="text-sm text-black/60 mt-1">Total de ítems en inventario.</p>
        </div>

        <div class="rounded-lg border border-black/10 bg-white p-5 shadow-sm">
            <div class="flex items-center">
                <i data-lucide="award" class="w-6 h-6 mr-3 text-brand"></i>
                <h3 class="text-sm font-semibold text-black/70 uppercase">Cliente con Más Reportes</h3>
            </div>
            {% if cliente_mas_reportes %}
                <p class="text-2xl font-bold mt-2 text-black">
                    {{ cliente_mas_reportes.nombre }}
                </p>
                <p class="text-sm text-black/60 mt-1">
                    Con un total de 
                    <span class="font-medium text-brand">{{ cliente_mas_reportes.total_reportes }}</span> 
                    reporte{{ cliente_mas_reportes.total_reportes|pluralize }}.
                </p>
            {% else %}
                <p class="text-xl font-bold mt-2 text-black/60">
                    N/A
                </p>
                <p class="text-sm text-black/60 mt-1">Se requiere al menos un reporte para calcular.</p>
            {% endif %}
        </div>
    </div>


{% else %} 
    <p class="mb-3">Todavia no has iniciado sesion</p>

    <li class="list-none">
        <a href="{% url 'login' %}"
           class="inline-flex items-center rounded-md border border-black px-4 py-2 text-sm font-medium text-black hover:bg-brand hover:border-brand hover:text-white transition-colors">
            Login
        </a>
    </li>

{% endif %}

<footer class="mt-16 pt-8 border-t border-black/10 text-center">
    <p class="text-xs text-black/70">
        © 2025 Sistema de Reporte de Rechazo de Andamios Multidireccionales.
    </p>
    <p class="text-xs text-black/50 mt-1">
        Desarrollado para Uziel Cares.
    </p>
</footer>


{% endblock%}



